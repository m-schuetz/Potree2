<html>
<head>
<meta http-equiv="origin-trial" content="ApM2LRrizp8n6n1p9IaYNL9tbGYTRob0jgm5wOr1jPQeXXyKTqNbaZKaC2LgVTyizCde6tC6XL0ZeH28L/z3EAEAAABdeyJvcmlnaW4iOiJodHRwczovL3BvdHJlZS5vcmc6NDQzIiwiZmVhdHVyZSI6IldlYkdQVSIsImV4cGlyeSI6MTY0MzE1NTE5OSwiaXNTdWJkb21haW4iOnRydWV9">
<style>

td{
	padding: 2px 10px 0px 0px;
}

#big_message{
	position: absolute; 
	left: calc(50%); 
	bottom: 10px; 
	color: white;
	text-shadow: 4px 4px 4px black;
	font-size: 4em;
	font-weight: bold;
	font-family: "Consolas";
	/* from https://stackoverflow.com/a/14249403/913630 */
	text-shadow: 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black;
}

#msg_dbg{
	position: absolute; 
	left: 10px; 
	bottom: 10px; 
	color: white;
	text-shadow: 4px 4px 4px black;
	font-size: 1em;
	font-weight: bold;
	font-family: "Consolas";
	/* from https://stackoverflow.com/a/14249403/913630 */
	text-shadow: 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black, 0 0 4px black;
}

canvas{
	image-rendering: pixelated;
}

</style>
</head>
<body style="padding: 0; margin: 0">


<canvas id="canvas" width="800" height="600" 
	style="
		width: 100%; height: 100%;
		grid-column: 1; grid-row: 1">
</canvas>

<!-- <span style="position: absolute; left: 10px; top: 70px; 
	background-color: white; opacity: 0.7; padding: 10px;">
	
	<span style="font-weight: bold">Rewriting Potree in WebGPU:</span>

	<ul>
		<li>Highly experimental and crashy.</li>
		<li>Requires <a href="https://www.google.com/intl/de/chrome/canary/">Chrome Canary 92</a></li>
		<li>To enable WebGPU, open this URL: <pre>chrome://flags/#enable-unsafe-webgpu</pre></li>
		<li>Github: <a href="https://github.com/m-schuetz/Potree2">https://github.com/m-schuetz/Potree2</a></li>
	</ul>

</span> -->

<span id="big_message"></span>
<span id="msg_dbg"></span>

<script type="importmap">
{
	"imports": {
		"potree":      "./src/Potree.js",
		"lazperf":     "./libs/laz-perf/laz-perf.js",
		"toolbar":     "./src/modules/toolbar/toolbar.js",
		"dat.gui":     "./libs/dat.gui/dat.gui.module.js",
		"stats":       "./libs/stats.js/stats.module.js",
		"BinaryHeap":  "./libs/BinaryHeap/BinaryHeap.js",
		"tween":       "./libs/tween/tween.esm.js"
	}
}
</script>

<script type="module">

	import {Potree} from "potree";
	import {Vector3, Mesh, Geometry, geometries, Points, PointLight} from "potree";
	import {WireframeMaterial, TriangleColorMaterial} from "potree";
	import {initGUI} from "./src/modules/gui_dat/gui.js";
	// import {loadGLB} from "./src/prototyping/glbloader/loadGLB.js";
	// import {GlbVoxelLoader} from "./src/misc/glbvoxels/GlbVoxelLoader.js";

	import {installToolbar} from "toolbar";

	let canvas = document.getElementById("canvas");
	let potree = await Potree.init(canvas);
	let {scene, controls} = potree;
	// installToolbar(potree.renderer.canvas, potree);

	window.Potree = Potree;
	window.potree = potree;
	window.Vector3 = Vector3;

	initGUI(potree);
	guiContent["point budget (M)"] = 3;
	guiContent["point size"] = 5;
	guiContent["High-Quality"] = true;
	guiContent["Eye-Dome-Lighting"] = true;
	guiContent["dilate"] = true;
	// guiContent["attribute"] = "intensity";


	// default, if not overriden later on
	controls.set({
		yaw: -0.2,
		pitch: 0.8,
		radius: 10,
	});

	controls.set({
		position: [-0.9, -3.7, -4.6],
		pivot: [-0.3, 0.4, -5.7],
	});

	controls.set({
		position: [-19.0, 13.6, 12.2],
		pivot: [-0.0, 2.2, 3.9],
	});

	// SITN
	// controls.set({
	// 	position: [2315.2, 1355.2, 949.8],
	// 	pivot: [2357.1, 1363.8, 931.0],
	// });

	// Potree.load("./resources/pointclouds/heidentor/metadata.json").then(pointcloud => {

	// 	controls.set({
	// 		position: [-19.0, 13.6, 12.2],
	// 		pivot: [-0.0, 2.2, 3.9],
	// 	});
		
	// 	scene.root.children.push(pointcloud);
	// });

	import {CopcLoader} from "potree";
	CopcLoader.load("./autzen-classified.copc.laz").then(pointcloud => {

		// controls.set({
		// 	position: [-19.0, 13.6, 12.2],
		// 	pivot: [-0.0, 2.2, 3.9],
		// });
		

		let min = new Vector3(635577.79, 848882.15, 406.14);
		let max = new Vector3(639003.73, 853537.66, 615.26);

		let center = min.add(max).multiplyScalar(0.5);
		let size = min.distanceTo(max);
		
		controls.set({
			yaw: -0.2,
			pitch: 0.8,
			radius: size,
			pivot: center,
		});

		scene.root.children.push(pointcloud);
	});

	// Potree.load("./resources/pointclouds/CA13/metadata.json").then(pointcloud => {

	// 	controls.set({
	// 		position: [694068.6, 3915209.4, 2092.8],
	// 		pivot: [694702.7, 3916648.3, -196.8],
	// 	});
		
	// 	scene.root.children.push(pointcloud);
	// });

	let origin = new Vector3(0, 0, 0);
	let X = new Vector3(10, 0, 0);
	let Y = new Vector3(0, 10, 0);
	let Z = new Vector3(0, 0, 10);
	let red = new Vector3(255, 0, 0);
	let green = new Vector3(0, 255, 0);
	let blue = new Vector3(0, 0, 255);

	import {sphere} from "./src/modules/geometries/sphere.js";

	potree.onUpdate( () => {

		potree.renderer.drawLine(origin, X, red);
		potree.renderer.drawLine(origin, Y, green);
		potree.renderer.drawLine(origin, Z, blue);

		potree.renderer.drawSphere(origin, 2);



		// potree.renderer.drawMesh({
		// 	"positions": sphere.buffers.find(b => b.name === "position").buffer,
		// 	"uvs": sphere.buffers.find(b => b.name === "uv").buffer,
		// 	"normals": sphere.buffers.find(b => b.name === "normal").buffer,
		// });
		// potree.renderer.drawMesh({positions, uvs, indices, world, image: node.material.image});

	});



</script>

</body>
</html>